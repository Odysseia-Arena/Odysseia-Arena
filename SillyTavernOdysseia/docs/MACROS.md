# å®ç³»ç»Ÿæƒå¨æ–‡æ¡£

**é‡è¦æç¤º**: æœ¬æ–‡æ¡£æè¿°äº† SillyTavern Odysseia å®ç³»ç»Ÿçš„**è®¾è®¡æ¶æ„**å’Œ**æ ¸å¿ƒåŠŸèƒ½**ã€‚è¿™æ˜¯ç†è§£å®ç³»ç»Ÿå·¥ä½œåŸç†ï¼ˆå¦‚ä½œç”¨åŸŸã€æ‰§è¡Œé¡ºåºç­‰ï¼‰çš„æƒå¨å‚è€ƒã€‚

å…³äºå…·ä½“æ¯ä¸ªä¼ ç»Ÿå®ï¼ˆå¦‚ `{{time}}`, `{{roll}}` ç­‰ï¼‰æ˜¯å¦å·²å®ç°ï¼Œè¯·å‚è€ƒ **[å®ç°çŠ¶æ€æ–‡æ¡£](å®ç°çŠ¶æ€.md)**ï¼Œè¯¥æ–‡æ¡£æä¾›äº†æœ€å‡†ç¡®çš„å®æ”¯æŒåˆ—è¡¨ã€‚

---

# å®ç³»ç»Ÿæ–‡æ¡£

SillyTavern Odysseia æ”¯æŒå¼ºå¤§çš„å®ç³»ç»Ÿï¼ŒåŒ…æ‹¬ä¼ ç»ŸSillyTavernå®å…¼å®¹æ€§å’Œ**å®Œå…¨æ”¯æŒçš„ç°ä»£Pythonä»£ç æ‰§è¡Œèƒ½åŠ›ï¼ˆ100%å¯ç”¨ï¼‰**ã€‚

## ğŸ¯ å®çš„å·¥ä½œåŸç†

### å¤šå†…å®¹éƒ¨åˆ†æ¶æ„
ç³»ç»Ÿé‡‡ç”¨å»¶è¿Ÿåˆå¹¶çš„è®¾è®¡ï¼Œç¡®ä¿æ¯ä¸ªå†…å®¹éƒ¨åˆ†ä¿æŒå…¶æ¥æºæ ‡è®°ç›´åˆ°æœ€ç»ˆè¾“å‡ºï¼š

#### æ‰§è¡Œæµç¨‹
1. **æ„å»ºé˜¶æ®µ**: åˆ›å»ºåŒ…å«å¤šä¸ªContentPartçš„ChatMessageï¼Œæ¯éƒ¨åˆ†æ ‡è®°æ¥æº
2. **Depthå¤„ç†**: åœ¨ChatMessageçº§åˆ«å¤„ç†depthæ’å…¥ï¼Œä¿æŒå†…éƒ¨ç»“æ„
3. **Relativeæ‹¼æ¥**: åŠ å…¥relativeé¢„è®¾ï¼Œä»ä¿æŒå¤šä¸ªcontent_parts
4. **Roleåˆå¹¶**: åˆå¹¶ç›¸é‚»ç›¸åŒroleï¼Œåˆå¹¶å„è‡ªçš„content_partsåˆ—è¡¨
5. **ä»£ç å—æ‰§è¡Œ**: æŒ‰æœ€ç»ˆæç¤ºè¯é¡ºåºæ‰§è¡Œæ‰€æœ‰Pythonä»£ç å—
6. **å®å¤„ç†**: æ¯ä¸ªcontent_partä½¿ç”¨å…¶source_typeä½œç”¨åŸŸå¤„ç†å®
7. **æœ€ç»ˆæ‹¼æ¥**: åªåœ¨è¾“å‡ºæ—¶ç”¨åŒæ¢è¡Œç¬¦ï¼ˆ\\n\\nï¼‰åˆå¹¶content_parts

### ç²¾ç¡®ä½œç”¨åŸŸæ„ŸçŸ¥
æ¯ä¸ªå†…å®¹éƒ¨åˆ†ï¼ˆContentPartï¼‰ä¿æŒç‹¬ç«‹çš„æ¥æºæ ‡è®°ï¼š

```python
# èåˆæ¶ˆæ¯ç¤ºä¾‹
ChatMessage(
    role=USER,
    content_parts=[
        ContentPart("{{setvar::input::hello}}", "conversation", "user"),     # â†’ conversation_vars
        ContentPart("{{setvar::location::forest}}", "world", "entry_1"),     # â†’ world_vars  
        ContentPart("{{setvar::mode::debug}}", "preset", "system")           # â†’ preset_vars
    ]
)
```

#### ä½œç”¨åŸŸæ˜ å°„
- **conversationéƒ¨åˆ†** â†’ `conversation_vars` (çœŸå®å¯¹è¯å†…å®¹)
- **worldéƒ¨åˆ†** â†’ `world_vars` (ç¯å¢ƒå’Œä¸–ç•ŒçŠ¶æ€)
- **charéƒ¨åˆ†** â†’ `char_vars` (è§’è‰²çŠ¶æ€å’Œå±æ€§)
- **presetéƒ¨åˆ†** â†’ `preset_vars` (ç³»ç»Ÿé…ç½®å’ŒæŒ‡ä»¤)

## ğŸ“ SillyTavernå…¼å®¹å®

### ğŸ”§ å®è¯­æ³•æ”¹è¿› âœ¨**æ–°å¢**

ç³»ç»Ÿç°åœ¨æ”¯æŒ**å‡½æ•°è°ƒç”¨è¯­æ³•**ï¼Œæä¾›æ›´çµæ´»çš„å®ä½¿ç”¨æ–¹å¼ï¼š

#### ä¼ ç»Ÿè¯­æ³• vs å‡½æ•°è°ƒç”¨è¯­æ³•
```python
# ä¼ ç»Ÿè¯­æ³•ï¼ˆä»ç„¶æ”¯æŒï¼‰
{{setvar::name::value}}
{{getvar::name}}

# å‡½æ•°è°ƒç”¨è¯­æ³•ï¼ˆæ–°å¢ï¼‰
{{setvar('name', 'value')}}
{{getvar('name')}}
{{setvar('status', 'active')}}{{getvar('status')}}  # å¯ä»¥ç»„åˆä½¿ç”¨
```

#### æ”¯æŒå‡½æ•°è°ƒç”¨è¯­æ³•çš„å®
- `setvar()` - è®¾ç½®å˜é‡ï¼š`{{setvar('hp', 100)}}`
- `getvar()` - è·å–å˜é‡ï¼š`{{getvar('hp')}}`
- `addvar()` - å˜é‡ç›¸åŠ ï¼š`{{addvar('score', 10)}}`
- `incvar()` - å˜é‡é€’å¢ï¼š`{{incvar('level')}}`
- `decvar()` - å˜é‡é€’å‡ï¼š`{{decvar('hp')}}`
- `setglobalvar()` - è®¾ç½®å…¨å±€å˜é‡ï¼š`{{setglobalvar('config', 'value')}}`
- `getglobalvar()` - è·å–å…¨å±€å˜é‡ï¼š`{{getglobalvar('config')}}`

#### ä¼˜åŠ¿
- **æ›´ç›´è§‚**: ç±»ä¼¼å‡½æ•°è°ƒç”¨çš„è¯­æ³•æ›´ç¬¦åˆç¼–ç¨‹ä¹ æƒ¯
- **æ›´çµæ´»**: æ”¯æŒåµŒå¥—å’Œç»„åˆä½¿ç”¨
- **å‘åå…¼å®¹**: ä¼ ç»Ÿè¯­æ³•ä»ç„¶å®Œå…¨æ”¯æŒ

### åŸºç¡€å˜é‡å®

#### èº«ä»½ä¿¡æ¯
- `{{user}}` - ç”¨æˆ·å
- `{{char}}` - è§’è‰²å
- `{{description}}` - è§’è‰²æè¿°
- `{{personality}}` - è§’è‰²æ€§æ ¼
- `{{scenario}}` - è§’è‰²åœºæ™¯
- `{{persona}}` - ç”¨æˆ·è§’è‰²æè¿°

#### æ—¶é—´æ—¥æœŸ
- `{{time}}` - å½“å‰æ—¶é—´ (HH:MM:SS)
- `{{date}}` - å½“å‰æ—¥æœŸ (YYYY-MM-DD)
- `{{weekday}}` - æ˜ŸæœŸå‡ 
- `{{isotime}}` - ISOæ—¶é—´æ ¼å¼
- `{{isodate}}` - ISOæ—¥æœŸæ ¼å¼
- `{{datetimeformat:DD.MM.YYYY HH:mm}}` - è‡ªå®šä¹‰æ—¥æœŸæ—¶é—´æ ¼å¼ âœ¨**æ–°å¢**
- `{{time_UTC+8}}` / `{{time_UTC-5}}` - UTCæ—¶åŒºåç§»æ—¶é—´ âœ¨**æ–°å¢**
- `{{timeDiff::time1::time2}}` - è®¡ç®—ä¸¤ä¸ªæ—¶é—´ä¹‹é—´çš„å·®å€¼ âœ¨**æ–°å¢**

#### èŠå¤©ä¿¡æ¯
- `{{input}}` - ç”¨æˆ·è¾“å…¥
- `{{lastMessage}}` - æœ€åä¸€æ¡æ¶ˆæ¯
- `{{lastUserMessage}}` - æœ€åä¸€æ¡ç”¨æˆ·æ¶ˆæ¯
- `{{lastCharMessage}}` - æœ€åä¸€æ¡è§’è‰²æ¶ˆæ¯

#### åŠŸèƒ½æ€§å®
- `{{trim}}` - ä¿®å‰ªæ­¤å®å‘¨å›´çš„æ¢è¡Œç¬¦ âœ¨**æ–°å¢**
- `{{pick:é€‰é¡¹1,é€‰é¡¹2,é€‰é¡¹3}}` - æŒä¹…åŒ–éšæœºé€‰æ‹©ï¼ˆä¼šè¯å†…ä¿æŒä¸€è‡´ï¼‰âœ¨**æ–°å¢**
- `{{pick::é€‰é¡¹1::é€‰é¡¹2::é€‰é¡¹3}}` - æŒä¹…åŒ–é€‰æ‹©çš„åŒå†’å·è¯­æ³• âœ¨**æ–°å¢**

#### éšæœºå’Œéª°å­å® âœ¨**æ–°å¢**
- `{{roll::1d6}}` - éª°å­æŠ•æ·ï¼Œæ”¯æŒæ ‡å‡†éª°å­è¡¨è¾¾å¼ï¼ˆå¦‚1d6, 2d10+5ï¼‰
- `{{random::è‹¹æœ::é¦™è•‰::æ©˜å­}}` - ä»é€‰é¡¹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
- `{{random::0.3}}` - ç”Ÿæˆ0-1ä¹‹é—´çš„éšæœºæ•°ï¼Œå‚æ•°ä¸ºæ¦‚ç‡é˜ˆå€¼æ—¶è¿”å›å¸ƒå°”å€¼

#### å­—ç¬¦ä¸²æ“ä½œå® âœ¨**æ–°å¢**
- `{{stringop::replace::åŸæ–‡æœ¬::æŸ¥æ‰¾::æ›¿æ¢}}` - å­—ç¬¦ä¸²æ›¿æ¢æ“ä½œ
- `{{stringop::upper::æ–‡æœ¬}}` - è½¬æ¢ä¸ºå¤§å†™
- `{{stringop::lower::æ–‡æœ¬}}` - è½¬æ¢ä¸ºå°å†™
- `{{stringop::trim::æ–‡æœ¬}}` - å»é™¤é¦–å°¾ç©ºç™½å­—ç¬¦

### ä½œç”¨åŸŸæ„ŸçŸ¥å˜é‡å®

#### å±€éƒ¨å˜é‡ï¼ˆç²¾ç¡®ä½œç”¨åŸŸæ„ŸçŸ¥ï¼‰
- `{{setvar::name::value}}` - è®¾ç½®å˜é‡åˆ°å½“å‰ContentPartçš„ä½œç”¨åŸŸ
- `{{getvar::name}}` - ä»å½“å‰ContentPartçš„ä½œç”¨åŸŸè·å–å˜é‡

**æ ¸å¿ƒæœºåˆ¶**ï¼šæ¯ä¸ªContentPartçš„å®ä½¿ç”¨å…¶source_typeç¡®å®šä½œç”¨åŸŸ

```bash
# èåˆæ¶ˆæ¯ä¸­çš„ä¸åŒéƒ¨åˆ†ï¼š
# ContentPart 1: source_type="preset"
{{setvar::init_hp::100}}     # è®¾ç½®åˆ°preset_vars['init_hp']
{{getvar::init_hp}}          # ä»preset_varsè·å–

# ContentPart 2: source_type="char"  
{{setvar::mood::happy}}      # è®¾ç½®åˆ°char_vars['mood']
{{getvar::mood}}             # ä»char_varsè·å–

# ContentPart 3: source_type="world"
{{setvar::location::forest}} # è®¾ç½®åˆ°world_vars['location']
{{getvar::location}}         # ä»world_varsè·å–

# ContentPart 4: source_type="conversation"
{{setvar::user_input::hello}} # è®¾ç½®åˆ°conversation_vars['user_input']
{{getvar::user_input}}        # ä»conversation_varsè·å–
```

**é‡è¦ç‰¹æ€§**ï¼š
- âœ… åŒä¸€èåˆæ¶ˆæ¯ä¸­çš„ä¸åŒéƒ¨åˆ†å¯ä»¥æœ‰ä¸åŒçš„ä½œç”¨åŸŸ
- âœ… åŒåå˜é‡åœ¨ä¸åŒä½œç”¨åŸŸä¸­å®Œå…¨éš”ç¦»
- âœ… æ¯ä¸ªå®æ ¹æ®å…¶æ‰€åœ¨çš„ContentPartè‡ªåŠ¨é€‰æ‹©æ­£ç¡®ä½œç”¨åŸŸ

#### å…¨å±€å˜é‡
- `{{setglobalvar::name::value}}` - è®¾ç½®å…¨å±€å˜é‡
- `{{getglobalvar::name}}` - è·å–å…¨å±€å˜é‡
- `{{addglobalvar::name::increment}}` - å…¨å±€å˜é‡æ•°å€¼åŠ æ³• âœ¨**æ–°å¢**
- `{{incglobalvar::name}}` - å…¨å±€å˜é‡è‡ªå¢ï¼ˆè¿”å›æ–°å€¼ï¼‰âœ¨**æ–°å¢**
- `{{decglobalvar::name}}` - å…¨å±€å˜é‡è‡ªå‡ï¼ˆè¿”å›æ–°å€¼ï¼‰âœ¨**æ–°å¢**

## ğŸ Pythonå®ç³»ç»Ÿ âœ… **100%å¯ç”¨**

### Pythonä»£ç æ‰§è¡Œ
ä½¿ç”¨`{{python:code}}`è¯­æ³•æ‰§è¡ŒPythonä»£ç ï¼Œ**ç°å·²å®Œå…¨é›†æˆåˆ°APIæ¥å£ä¸­**ï¼š

```python
# åŸºç¡€è®¡ç®—
{{python:2 + 3}}           # è¾“å‡º: 5
{{python:15 + 10}}         # è¾“å‡º: 25
{{python:3.14 * 2}}        # è¾“å‡º: 6.28

# å­—ç¬¦ä¸²æ“ä½œ
{{python:'Hello ' + 'World'}}              # è¾“å‡º: Hello World
{{python:'è§’è‰²å: ' + getvar('name')}}      # è¾“å‡º: è§’è‰²å: Alice

# æ¡ä»¶åˆ¤æ–­
{{python:'æ˜¯' if True else 'å¦'}}                                # è¾“å‡º: æ˜¯
{{python:'ä¼˜ç§€' if int(getvar('score')) >= 90 else 'è‰¯å¥½'}}      # è¾“å‡º: ä¼˜ç§€

# å˜é‡æ“ä½œ
{{python:setvar('level', 5)}}              # è®¾ç½®å˜é‡
{{python:getvar('level')}}                 # è¾“å‡º: 5

# ç±»å‹è½¬æ¢
{{python:int('42')}}                       # è¾“å‡º: 42
{{python:str(123)}}                        # è¾“å‡º: 123
{{python:float('3.14')}}                   # è¾“å‡º: 3.14

# å¤æ‚è®¡ç®—
{{python:100 - int(getvar('hp'))}}         # å˜é‡è®¡ç®—
{{python:max(10, 20, 30)}}                 # è¾“å‡º: 30
```

### ä½œç”¨åŸŸå˜é‡è®¿é—®

#### 1. å‰ç¼€ç›´æ¥è®¿é—®
```python
{{python:preset_variable_name}}    # ç›´æ¥è®¿é—®é¢„è®¾å˜é‡
{{python:char_variable_name}}      # ç›´æ¥è®¿é—®è§’è‰²å˜é‡
{{python:world_variable_name}}     # ç›´æ¥è®¿é—®ä¸–ç•Œä¹¦å˜é‡
{{python:conv_variable_name}}      # ç›´æ¥è®¿é—®å¯¹è¯å˜é‡
{{python:global_variable_name}}    # ç›´æ¥è®¿é—®å…¨å±€å˜é‡
```

#### 2. å‡½æ•°å¼è®¿é—®
```python
# è·å–å˜é‡
{{python:get_preset('name')}}      # è·å–é¢„è®¾å˜é‡
{{python:get_char('name')}}        # è·å–è§’è‰²å˜é‡
{{python:get_world('name')}}       # è·å–ä¸–ç•Œä¹¦å˜é‡
{{python:get_conv('name')}}        # è·å–å¯¹è¯å˜é‡
{{python:get_global('name')}}      # è·å–å…¨å±€å˜é‡

# è®¾ç½®å˜é‡
{{python:set_preset('name', 'value')}}   # è®¾ç½®é¢„è®¾å˜é‡
{{python:set_char('name', 'value')}}     # è®¾ç½®è§’è‰²å˜é‡
{{python:set_world('name', 'value')}}    # è®¾ç½®ä¸–ç•Œä¹¦å˜é‡
{{python:set_conv('name', 'value')}}     # è®¾ç½®å¯¹è¯å˜é‡
{{python:set_global('name', 'value')}}   # è®¾ç½®å…¨å±€å˜é‡
```

#### 3. ä½œç”¨åŸŸæ„ŸçŸ¥å‡½æ•°
```python
# åœ¨ä»»ä½•ä½œç”¨åŸŸä¸­ä½¿ç”¨ï¼Œè‡ªåŠ¨é€‰æ‹©å½“å‰ä½œç”¨åŸŸ
{{python:setvar('name', 'value')}}  # è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸ
{{python:getvar('name')}}           # ä»å½“å‰ä½œç”¨åŸŸè·å–
```

### è‡ªåŠ¨å®è½¬æ¢

ç³»ç»Ÿä¼šè‡ªåŠ¨å°†SillyTavernå®è½¬æ¢ä¸ºPythonä»£ç ï¼š

```python
# åŸå§‹å® â†’ Pythonå®
{{char}}                    â†’ {{python:char}}
{{setvar::hp::100}}         â†’ {{python:setvar("hp", "100")}}
{{getvar::hp}}              â†’ {{python:getvar("hp")}}
{{setglobalvar::name::AI}}  â†’ {{python:setglobalvar("name", "AI")}}
```

## ğŸ”§ ä»£ç å—ç³»ç»Ÿ

### ä»£ç å—è¯­æ³•

åœ¨ä»»ä½•JSONé…ç½®æ–‡ä»¶ä¸­æ·»åŠ `code_block`å­—æ®µï¼š

```json
{
  "name": "ç¤ºä¾‹æ¡ç›®",
  "content": "æ­£å¸¸å†…å®¹",
  "code_block": "set_preset('initialized', True); print('åˆå§‹åŒ–å®Œæˆ')"
}
```

### æ‰§è¡Œæ—¶æœº

1. **æœ€ç»ˆæ‹¼æ¥åæ‰§è¡Œ**ï¼šç­‰å¾…æ‰€æœ‰å†…å®¹æŒ‰æ¬¡åºè§„åˆ™æ‹¼æ¥å®Œæˆ
2. **ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ**ï¼šæŒ‰æœ€ç»ˆæç¤ºè¯ä¸­å‡ºç°çš„é¡ºåºæ‰§è¡Œä»£ç å—
3. **ä½œç”¨åŸŸéš”ç¦»**ï¼šæ¯ä¸ªä»£ç å—åœ¨å…¶å¯¹åº”çš„ä½œç”¨åŸŸä¸­æ‰§è¡Œ

### ä»£ç å—ç¤ºä¾‹

#### é¢„è®¾åˆå§‹åŒ–
```json
{
  "identifier": "system_init", 
  "content": "ç³»ç»Ÿåˆå§‹åŒ–...",
  "code_block": "set_preset('system_ready', True); set_preset('turn', 1)"
}
```

#### è§’è‰²çŠ¶æ€è®¾ç½®
```json
{
  "name": "è§’è‰²çŠ¶æ€",
  "description": "å‹‡æ•¢çš„éª‘å£«",
  "code_block": "setvar('class', 'knight'); setvar('level', '1')"
}
```

#### ä¸–ç•Œä¹¦è§¦å‘
```json
{
  "name": "æˆ˜æ–—åœºæ™¯",
  "keys": ["æˆ˜æ–—", "æ”»å‡»"],
  "content": "è¿›å…¥æˆ˜æ–—æ¨¡å¼",
  "code_block": "setvar('in_combat', 'true'); setvar('combat_round', '1')"
}
```

#### åŠ¨æ€enabled + code_blockç»„åˆ
```json
{
  "name": "é«˜çº§æŠ€èƒ½",
  "enabled": "{{python:getvar('player_level') >= 10}}",
  "content": "é«˜çº§æŠ€èƒ½è§£é”",
  "code_block": "setvar('advanced_skills', 'true'); setvar('skill_points', '5')"
}
```

## ğŸ›ï¸ åŠ¨æ€enabledå­—æ®µ

### enabledå­—æ®µçš„å®è¯­æ³•

#### åŸºç¡€æ ¼å¼
```json
// å¸ƒå°”å€¼ï¼ˆå‘åå…¼å®¹ï¼‰
"enabled": true,
"enabled": false,

// å˜é‡å®
"enabled": "{{getvar::debug_mode}}",
"enabled": "{{getglobalvar::system_ready}}",

// éšæœºæ¦‚ç‡
"enabled": "{{random::0.3}}",  // 30%æ¦‚ç‡å¯ç”¨

// æ¡ä»¶åˆ¤æ–­
"enabled": "{{if::{{getvar::level}}::>5::true::false}}"
```

#### Pythonè¡¨è¾¾å¼ï¼ˆæ¨èæ ¼å¼ï¼‰
```json
// æ•°å€¼æ¯”è¾ƒ
"enabled": "{{python:getvar('player_level') >= 10}}",

// å­—ç¬¦ä¸²åŒ¹é…
"enabled": "{{python:getvar('mode') == 'combat'}}",

// å¤æ‚é€»è¾‘
"enabled": "{{python:len(getvar('inventory')) > 0 and getvar('coins') >= 100}}",

// æ—¶é—´æ¡ä»¶
"enabled": "{{python:get_global('hour') >= 18}}"
```

### åŠ¨æ€æ„å»ºæµç¨‹

1. **åˆå§‹åŒ…å«é˜¶æ®µ**: åŒ…å«æ‰€æœ‰é`enabled=false`çš„æ¡ç›®
2. **ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ**: æŒ‰injection_orderé¡ºåºä¾æ¬¡åˆ¤æ–­
3. **ä»£ç å—æ‰§è¡Œ**: å¯ç”¨çš„æ¡ç›®æ‰§è¡Œå…¶code_block
4. **çŠ¶æ€æ›´æ–°**: ä»£ç æ‰§è¡Œå¯å½±å“åç»­æ¡ç›®çš„enabledåˆ¤æ–­
5. **æœ€ç»ˆè¿‡æ»¤**: ç§»é™¤æœ€ç»ˆåˆ¤æ–­ä¸ºç¦ç”¨çš„æ¡ç›®

## âœ¨ å®å¤„ç†ä¼˜åŒ–

### æ™ºèƒ½æ¢è¡Œç¬¦æ¸…ç†
ç³»ç»Ÿå…·å¤‡å¢å¼ºçš„æ¢è¡Œç¬¦æ¸…ç†é€»è¾‘ï¼Œèƒ½å¤Ÿæ™ºèƒ½å¤„ç†å®æ‰§è¡Œåç•™ä¸‹çš„ç©ºç™½å ä½ï¼š

#### æ“ä½œæ€§å®è¯†åˆ«
ä»¥ä¸‹å®è¢«è¯†åˆ«ä¸ºæ“ä½œæ€§å®ï¼Œæ‰§è¡Œåä¸ä¿ç•™å†…å®¹ï¼Œå‘¨å›´çš„æ¢è¡Œç¬¦ä¼šè¢«è‡ªåŠ¨æ¸…ç†ï¼š
- `{{setvar::name::value}}`
- `{{setglobalvar::name::value}}`  
- `{{addvar::name::value}}`
- `{{incvar::name}}`/`{{decvar::name}}`
- `{{noop}}`
- `{{// æ³¨é‡Šå†…å®¹}}`

#### æ¸…ç†æ•ˆæœç¤ºä¾‹
```text
å¤„ç†å‰:
ç¬¬ä¸€è¡Œå†…å®¹
{{setvar::test::hello}}
{{setvar::mode::debug}}

ç¬¬äºŒè¡Œå†…å®¹

å¤„ç†å:
ç¬¬ä¸€è¡Œå†…å®¹ç¬¬äºŒè¡Œå†…å®¹
```

#### å¤šå±‚æ¸…ç†æœºåˆ¶
1. **è¡Œçº§æ¸…ç†**: ç§»é™¤åªåŒ…å«ç©ºç™½å­—ç¬¦çš„è¡Œ
2. **æ®µè½çº§æ¸…ç†**: åˆå¹¶è¿‡å¤šçš„ç©ºè¡Œï¼Œæœ€å¤šä¿ç•™1ä¸ªç©ºè¡Œä½œä¸ºæ®µè½åˆ†éš”
3. **è¾¹ç•Œæ¸…ç†**: ç§»é™¤å¼€å¤´å’Œç»“å°¾çš„å¤šä½™æ¢è¡Œç¬¦
4. **æœ€ç»ˆéªŒè¯**: ç¡®ä¿æ¸…ç†åä»æœ‰æœ‰æ•ˆå†…å®¹

## ğŸ”’ å†…ç½®å˜é‡å’Œå‡½æ•°

### ä¿ç•™å˜é‡
- `enable` - å§‹ç»ˆä¸ºTrueï¼Œå¯åœ¨ä»»ä½•ä»£ç ä¸­ä½¿ç”¨

### å¯ç”¨å‡½æ•°
```python
# å˜é‡æ“ä½œ
setvar(name, value)        # è®¾ç½®å½“å‰ä½œç”¨åŸŸå˜é‡
getvar(name)               # è·å–å½“å‰ä½œç”¨åŸŸå˜é‡
setglobalvar(name, value)  # è®¾ç½®å…¨å±€å˜é‡
getglobalvar(name)         # è·å–å…¨å±€å˜é‡

# ä½œç”¨åŸŸå‡½æ•°
get_preset(name)           # è·å–é¢„è®¾å˜é‡
set_preset(name, value)    # è®¾ç½®é¢„è®¾å˜é‡
get_char(name)             # è·å–è§’è‰²å˜é‡
set_char(name, value)      # è®¾ç½®è§’è‰²å˜é‡
get_world(name)            # è·å–ä¸–ç•Œä¹¦å˜é‡
set_world(name, value)     # è®¾ç½®ä¸–ç•Œä¹¦å˜é‡
get_conv(name)             # è·å–å¯¹è¯å˜é‡
set_conv(name, value)      # è®¾ç½®å¯¹è¯å˜é‡
get_global(name)           # è·å–å…¨å±€å˜é‡
set_global(name, value)    # è®¾ç½®å…¨å±€å˜é‡

# åŸºç¡€ä¿¡æ¯å˜é‡
char                       # è§’è‰²å
user                       # ç”¨æˆ·å
description                # è§’è‰²æè¿°
time                       # å½“å‰æ—¶é—´
date                       # å½“å‰æ—¥æœŸ
input                      # ç”¨æˆ·è¾“å…¥
```

### å…è®¸çš„å†…ç½®å‡½æ•°
```python
# æ•°æ®ç±»å‹
str, int, float, bool, list, dict, tuple

# æ•°å­¦å‡½æ•°
abs, max, min, sum, len, round

# å­—ç¬¦ä¸²å‡½æ•°
chr, ord

# ç±»å‹æ£€æŸ¥
isinstance, type

# å…¶ä»–
range, enumerate, zip
```

## ğŸ›¡ï¸ å®‰å…¨é™åˆ¶

### ç¦æ­¢çš„æ“ä½œ
- å¯¼å…¥å¤–éƒ¨æ¨¡å— (`import`)
- æ–‡ä»¶ç³»ç»Ÿè®¿é—® (`open`, `file`)
- ç½‘ç»œè®¿é—®
- åŠ¨æ€æ‰§è¡Œ (`exec`, `eval`, `compile`)
- è®¿é—®å†…éƒ¨å˜é‡ (`globals`, `locals`, `__import__`)
- åˆ é™¤æ“ä½œ (`del`)

### æ‰§è¡Œé™åˆ¶
- **æ—¶é—´é™åˆ¶**ï¼š5ç§’è¶…æ—¶
- **å†…å­˜é™åˆ¶**ï¼šé˜²æ­¢æ— é™å¾ªç¯
- **æ²™ç›’éš”ç¦»**ï¼šæ— æ³•è®¿é—®ç³»ç»Ÿèµ„æº

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•
```python
# è®¾ç½®è§’è‰²å±æ€§
{{setvar::hp::100}}
{{setvar::mp::50}}

# æ˜¾ç¤ºçŠ¶æ€
è§’è‰²çŠ¶æ€ï¼šç”Ÿå‘½å€¼{{getvar::hp}}/{{getvar::max_hp}}ï¼Œé­”æ³•å€¼{{getvar::mp}}/{{getvar::max_mp}}

# Pythonè®¡ç®—
å½“å‰è¡€é‡ç™¾åˆ†æ¯”ï¼š{{python:round(int(getvar('hp')) / int(getvar('max_hp')) * 100, 1)}}%
```

### æ–°åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹ âœ¨

#### æŒä¹…åŒ–é€‰æ‹©å®
```python
# åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­ä¿æŒé€‰æ‹©ç»“æœä¸å˜
é€‰æ‹©æ­¦å™¨ï¼š{{pick:å‰‘,å¼“,æ³•æ–}}
é€‰æ‹©æŠ€èƒ½ï¼š{{pick::ç«çƒæœ¯::å†°ç®­æœ¯::æ²»ç–—æœ¯}}

# ç¬¬ä¸€æ¬¡æ‰§è¡Œï¼šé€‰æ‹©æ­¦å™¨ï¼šå‰‘ï¼Œé€‰æ‹©æŠ€èƒ½ï¼šç«çƒæœ¯
# ä¹‹åçš„æ‰§è¡Œï¼šé€‰æ‹©æ­¦å™¨ï¼šå‰‘ï¼Œé€‰æ‹©æŠ€èƒ½ï¼šç«çƒæœ¯ï¼ˆä¿æŒä¸€è‡´ï¼‰
```

#### å…¨å±€å˜é‡å¢å¼ºæ“ä½œ
```python
# è®¾ç½®åˆå§‹åˆ†æ•°
{{setglobalvar::total_score::0}}

# å¢åŠ åˆ†æ•°
è·å¾—å¥–åŠ±ï¼{{addglobalvar::total_score::50}}
å½“å‰æ€»åˆ†ï¼š{{getglobalvar::total_score}}

# è¿å‡»æ¬¡æ•°è‡ªå¢
è¿å‡»ï¼š{{incglobalvar::combo_count}}

# ç”Ÿå‘½å€¼è‡ªå‡
å—åˆ°ä¼¤å®³ï¼ç”Ÿå‘½å€¼ï¼š{{decglobalvar::player_hp}}
```

#### é«˜çº§æ—¶é—´å¤„ç†
```python
# è‡ªå®šä¹‰æ—¶é—´æ ¼å¼
å¾·å›½æ ¼å¼ï¼š{{datetimeformat:DD.MM.YYYY HH:mm}}
ç¾å›½æ ¼å¼ï¼š{{datetimeformat:MM/DD/YYYY hh:mm A}}

# æ—¶åŒºåç§»
åŒ—äº¬æ—¶é—´ï¼š{{time_UTC+8}}
çº½çº¦æ—¶é—´ï¼š{{time_UTC-5}}
ä¼¦æ•¦æ—¶é—´ï¼š{{time_UTC+0}}

# æ—¶é—´å·®è®¡ç®—
è·ç¦»æ–°å¹´è¿˜æœ‰ï¼š{{timeDiff::{{date}} {{time}}::2024-12-31 23:59:59}}
æ¸¸æˆå¼€å§‹æ—¶é—´å·®ï¼š{{timeDiff::2024-01-01 10:00:00::{{date}} {{time}}}}
```

#### trimå®ä½¿ç”¨
```python
# ç§»é™¤å¤šä½™æ¢è¡Œç¬¦
å‰é¢å†…å®¹

{{trim}}

åé¢å†…å®¹
# ç»“æœï¼šå‰é¢å†…å®¹åé¢å†…å®¹ï¼ˆä¸­é—´çš„æ¢è¡Œç¬¦è¢«ç§»é™¤ï¼‰
```

### é«˜çº§ç”¨æ³•
```python
# è·¨ä½œç”¨åŸŸå˜é‡è®¿é—®
{{python:f"ç©å®¶{get_preset('name')}åœ¨{get_world('location')}ï¼Œå¿ƒæƒ…{get_char('mood')}"}}

# æ¡ä»¶é€»è¾‘
{{python:'è¿›å…¥æˆ˜æ–—' if get_world('enemy_nearby') else 'å®‰å…¨åŒºåŸŸ'}}

# å¤æ‚è®¡ç®—
{{python:set_char('damage', max(1, get_char('attack') - get_world('enemy_defense')))}}
```

### è°ƒè¯•æŠ€å·§
```python
# æŸ¥çœ‹æ‰€æœ‰å˜é‡
{{python:f"é¢„è®¾å˜é‡: {[k for k in dir() if k.startswith('preset_')]}"}}
{{python:f"è§’è‰²å˜é‡: {[k for k in dir() if k.startswith('char_')]}"}}

# æ¡ä»¶è°ƒè¯•
{{python:print(f"è°ƒè¯•ä¿¡æ¯: hp={getvar('hp')}") if enable else ""}}
```

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»ä¼ ç»Ÿå®è¿ç§»
```python
# æ—§çš„å…¨å±€å˜é‡æ–¹å¼
{{setvar::player_name::Alice}}
{{getvar::player_name}}

# æ–°çš„ä½œç”¨åŸŸæ„ŸçŸ¥æ–¹å¼ï¼ˆè‡ªåŠ¨é€‚åº”ï¼‰
{{setvar::player_name::Alice}}  # è‡ªåŠ¨è®¾ç½®åˆ°å½“å‰ä½œç”¨åŸŸ
{{getvar::player_name}}         # ä»å½“å‰ä½œç”¨åŸŸè·å–

# æˆ–æ˜ç¡®æŒ‡å®šä½œç”¨åŸŸ
{{python:set_preset('player_name', 'Alice')}}
{{python:get_preset('player_name')}}
```

### åˆ©ç”¨æ–°åŠŸèƒ½
```python
# åˆ©ç”¨Pythonèƒ½åŠ›
{{python:get_char('name').upper()}}                    # å­—ç¬¦ä¸²æ–¹æ³•
{{python:[get_char('skill_' + str(i)) for i in range(5)]}}  # åˆ—è¡¨æ¨å¯¼
{{python:sum([get_preset('stat_' + s) for s in ['str', 'dex', 'int']])}}  # å¤æ‚è®¡ç®—
```

è¿™ä¸ªæ–°çš„å®ç³»ç»Ÿæä¾›äº†å‘åå…¼å®¹æ€§ï¼ŒåŒæ—¶å¼•å…¥äº†å¼ºå¤§çš„Pythonç¼–ç¨‹èƒ½åŠ›å’Œæ™ºèƒ½çš„ä½œç”¨åŸŸç®¡ç†ã€‚